<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BYtakÄ± | Eâ€‘Ticaret (Kodla YÃ¶netim)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card{box-shadow:0 8px 30px rgba(0,0,0,0.06)}
    .step.active{background:#6d28d9;color:#fff}
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <header class="bg-white border-b sticky top-0 z-50">
    <div class="max-w-7xl mx-auto p-4 flex items-center gap-3">
      <h1 class="text-2xl font-extrabold">BY<span class="text-fuchsia-600">takÄ±</span></h1>
      <a id="waHeader" target="_blank" class="ml-2 text-sm underline hidden">WhatsApp</a>
      <div class="ml-auto flex items-center gap-2">
        <button id="cartBtn" class="relative px-3 py-2 rounded-xl border">ğŸ›ï¸ Sepet <span id="cartCount" class="absolute -top-2 -right-2 text-xs bg-fuchsia-600 text-white rounded-full px-1">0</span></button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-6">
    <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    <div class="mt-6 flex gap-2">
      <a href="#" id="goHome" class="px-4 py-2 rounded-xl border">Ana sayfaya git</a>
      <button id="continueShopping" class="px-4 py-2 rounded-xl bg-fuchsia-600 text-white">AlÄ±ÅŸveriÅŸe devam et</button>
      <a id="contactSellerMain" target="_blank" class="px-4 py-2 rounded-xl border">SatÄ±cÄ±yla iletiÅŸime geÃ§</a>
    </div>
  </main>

  <!-- Sepet & Checkout (tam ekran) -->
  <div id="checkoutView" class="fixed inset-0 bg-white hidden z-40 overflow-y-auto">
    <div class="max-w-4xl mx-auto p-6">
      <div class="flex items-center gap-2 mb-6">
        <h3 class="text-2xl font-bold">SatÄ±n Alma</h3>
        <button id="closeCheckout" class="ml-auto px-3 py-2 border rounded">Kapat</button>
      </div>
      <!-- Steps -->
      <div class="grid grid-cols-3 gap-2 mb-6">
        <div id="s1" class="step text-center py-2 rounded-xl border">1) Sepet</div>
        <div id="s2" class="step text-center py-2 rounded-xl border">2) Bilgiler</div>
        <div id="s3" class="step text-center py-2 rounded-xl border">3) Ã–deme</div>
      </div>

      <!-- Step 1: Sepet -->
      <section id="step1" class="space-y-3">
        <div id="cartItems" class="space-y-3"></div>
        <div class="flex items-center justify-between border-t pt-4">
          <div class="text-lg">Ara Toplam: <strong id="cartSubtotal">â‚º0</strong></div>
          <button id="toStep2" class="px-4 py-2 rounded-xl bg-fuchsia-600 text-white">Devam Et</button>
        </div>
      </section>

      <!-- Step 2: Bilgiler -->
      <section id="step2" class="hidden">
        <form id="infoForm" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <input name="name" placeholder="Ad Soyad" class="border p-2 rounded" required>
          <input name="phone" placeholder="Telefon" class="border p-2 rounded">
          <textarea name="address" placeholder="Adres (isteÄŸe baÄŸlÄ±)" rows="3" class="border p-2 rounded sm:col-span-2"></textarea>
        </form>
        <div class="flex items-center justify-between mt-4">
          <button id="backTo1" class="px-4 py-2 rounded-xl border">Geri</button>
          <button id="toStep3" class="px-4 py-2 rounded-xl bg-fuchsia-600 text-white">Ã–deme AdÄ±mÄ±</button>
        </div>
      </section>

      <!-- Step 3: Ã–deme SeÃ§enekleri -->
      <section id="step3" class="hidden">
        <div class="card border rounded-2xl p-4 mb-4">
          <h4 class="font-semibold mb-2">EFT / Havale</h4>
          <p class="text-sm text-slate-600">EFT ile Ã¶demeyi seÃ§tiÄŸinde IBAN bilgilerinin olduÄŸu sayfaya yÃ¶nlendirileceksin.</p>
          <button id="payEFT" class="mt-3 px-4 py-2 rounded-xl bg-emerald-600 text-white">EFT ile Ã–de (IBAN sayfasÄ±)</button>
        </div>
        <div class="card border rounded-2xl p-4 mb-4">
          <h4 class="font-semibold mb-2">WhatsApp'tan Ä°letiÅŸime GeÃ§</h4>
          <p class="text-sm text-slate-600">SipariÅŸ detaylarÄ±n hazÄ±r metinle WhatsApp'a aktarÄ±lÄ±r.</p>
          <button id="payWA" class="mt-3 px-4 py-2 rounded-xl border">WhatsApp'tan Ä°letiÅŸime GeÃ§</button>
        </div>
        <div class="flex flex-wrap gap-2 mt-2">
          <button id="backTo2" class="px-4 py-2 rounded-xl border">Geri</button>
          <button id="continueShopping2" class="px-4 py-2 rounded-xl bg-fuchsia-600 text-white">AlÄ±ÅŸveriÅŸe devam et</button>
          <a id="goHome2" href="#" class="px-4 py-2 rounded-xl border">Ana sayfaya git</a>
          <a id="contactSellerStep3" target="_blank" class="px-4 py-2 rounded-xl border">SatÄ±cÄ±yla iletiÅŸime geÃ§</a>
        </div>
      </section>
    </div>
  </div>

  <!-- ÃœrÃ¼n Detay Modal -->
  <div id="detailModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl w-full max-w-3xl card overflow-hidden">
      <div class="flex items-center gap-2 p-4 border-b">
        <h3 id="detailTitle" class="text-lg font-bold">ÃœrÃ¼n DetayÄ±</h3>
        <button id="detailClose" class="ml-auto text-slate-500 hover:text-slate-900">âœ–</button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p (IBAN) SayfasÄ± -->
  <div id="paymentPage" class="fixed inset-0 bg-white hidden z-40 overflow-y-auto">
    <div class="max-w-3xl mx-auto p-6">
      <div class="flex items-center gap-2 mb-4">
        <h3 class="text-2xl font-bold">EFT / Havale Bilgileri</h3>
        <button id="closePayment" class="ml-auto px-3 py-2 border rounded">Kapat</button>
      </div>
      <div class="card border rounded-2xl p-4">
        <p><strong>Hesap AdÄ±:</strong> <span id="ibanName"></span></p>
        <p class="mt-1"><strong>IBAN:</strong> <span id="ibanText" class="font-mono"></span> <button id="copyIban" class="ml-2 px-2 py-1 text-xs border rounded">Kopyala</button></p>
        <p class="mt-1"><strong>Banka:</strong> <span id="bankName"></span></p>
        <p class="mt-3 text-sm text-slate-600">AÃ§Ä±klama kÄ±smÄ±na lÃ¼tfen <strong id="orderCodeSpan"></strong> yazÄ±nÄ±z.</p>
      </div>
      <div class="mt-6">
        <h4 class="font-semibold mb-2">SipariÅŸ Ã–zeti</h4>
        <div id="orderSummary" class="space-y-2"></div>
        <div class="mt-2 text-lg">Toplam: <strong id="orderTotal"></strong></div>
      </div>
    </div>
  </div>

  <footer class="mt-10 border-t">
    <div class="max-w-7xl mx-auto p-4 text-sm">
      WhatsApp: <a id="waFooter" class="underline" target="_blank"></a>
      Â· Ã–neri/Åikayet: <a class="underline" href="mailto:barisha@yaani.com?subject=BYtaki%20Geri%20Bildirim">barisha@yaani.com</a>
    </div>
  </footer>

  <script>
    // === AYARLAR ===
    const SELLER_WHATSAPP = '+905303042950'; // wa.me iÃ§in uluslararasÄ± format
    const SELLER_IBAN = 'TR00 0000 0000 0000 0000 0000 00'; // IBANINIZI girin
    const SELLER_IBAN_NAME = 'BYtakÄ±'; // hesap adÄ±
    const SELLER_BANK = 'Banka AdÄ±'; // banka adÄ±

    // === KODLA YÃ–NETÄ°M (BURAYI DÃœZENLE) ===
    // ÃœrÃ¼nleri ekle/Ã§Ä±kar: AÅŸaÄŸÄ±daki PRODUCTS dizisini dÃ¼zenle. Alanlar: title, code, price, discount, stock, img
    // IKAS'tan dÃ¶nÃ¼ÅŸtÃ¼rdÃ¼ÄŸÃ¼m JSON/CSV'yi buraya yapÄ±ÅŸtÄ±rabilirsin.
    const PRODUCTS = [
      { title:'Ä°nce Zincir Kolye', code:'BY002', price:699, discount:459, stock:15, img:'' },
      { title:'Minimal GÃ¼mÃ¼ÅŸ YÃ¼zÃ¼k', code:'BY001', price:499, discount:349, stock:10, img:'' },
      // { title:'...', code:'...', price:0, discount:0, stock:0, img:'https://...' },
    ];

    // === STORAGE KEYS ===
    const LS_REVIEWS='bytaki_reviews';
    const LS_PURCHASED='bytaki_purchased';
    const LS_CART='bytaki_cart';
    const LS_STOCK_OVR='bytaki_stock_overrides'; // kodla yÃ¶netimi bozmaz; sadece stok gÃ¼ncellemesi kalÄ±cÄ± olur

    // === STATE ===
    let reviews  = JSON.parse(localStorage.getItem(LS_REVIEWS) || '{}');
    let purchased= JSON.parse(localStorage.getItem(LS_PURCHASED) || '[]'); // tamamlanan sipariÅŸlerdeki Ã¼rÃ¼n kodlarÄ±
    let cart     = JSON.parse(localStorage.getItem(LS_CART) || '[]'); // [{code, qty}]
    let stockOv  = JSON.parse(localStorage.getItem(LS_STOCK_OVR) || '{}'); // {code: stok}
    let customer = {name:'', phone:'', address:''};
    let lastOrder = null; // {code, items:[{title,code,qty,price}], total}

    const $ = s => document.querySelector(s);
    const fmt = n => 'â‚º' + Number(n||0).toLocaleString('tr-TR');

    // WhatsApp linklerini baÄŸla
    const waNum = SELLER_WHATSAPP.replace(/\D/g,'');
    if(waNum){
      const waUrl = `https://wa.me/${waNum}`;
      const wh = document.getElementById('waHeader');
      const wf = document.getElementById('waFooter');
      if(wh){ wh.href = waUrl; wh.textContent = SELLER_WHATSAPP; wh.classList.remove('hidden'); }
      if(wf){ wf.href = waUrl; wf.textContent = SELLER_WHATSAPP; }
    }

    function saveAll(){
      localStorage.setItem(LS_REVIEWS, JSON.stringify(reviews));
      localStorage.setItem(LS_PURCHASED, JSON.stringify(purchased));
      localStorage.setItem(LS_CART, JSON.stringify(cart));
      localStorage.setItem(LS_STOCK_OVR, JSON.stringify(stockOv));
    }

    // Stok okuma / yazma (kodla yÃ¶netimi bozmadan kalÄ±cÄ± dÃ¼ÅŸÃ¼ÅŸ)
    function getStock(p){
      const ov = stockOv[p.code];
      return (ov===0 || ov) ? ov : (Number(p.stock)||0);
    }
    function setStock(code, value){ stockOv[code] = Math.max(0, Number(value)||0); saveAll(); }

    // === ÃœRÃœN LÄ°STE ===
    function renderProducts(){
      $('#productGrid').innerHTML = PRODUCTS.map(p=>{
        const curStock = getStock(p);
        const out = curStock <= 0;
        return `
        <article class='card bg-white p-4 rounded-2xl border ${out?"opacity-60":""}'>
          <img src='${p.img||"https://images.unsplash.com/photo-1613339027986-b94d85708949?w=800&auto=format&fit=crop"}' class='w-full h-48 object-cover rounded mb-3' alt='${p.title}'>
          <h3 class='font-bold'>${p.title}</h3>
          <p class='text-xs text-slate-500'>Kod: ${p.code}</p>
          <p class='text-xs'>Stok: ${curStock}</p>
          <div class='mt-1'><span class='text-fuchsia-600 font-bold'>${fmt(p.discount)}</span> <span class='line-through text-sm text-slate-400'>${fmt(p.price)}</span></div>
          <div class='mt-3 flex gap-2'>
            <button onclick="addToCart('${p.code}')" class='px-3 py-2 rounded-xl border' ${out?'disabled':''}>Sepete Ekle</button>
            <button onclick="openReviews('${p.code}')" class='px-3 py-2 rounded-xl border'>Yorumlar</button>
          </div>
        </article>`;
      }).join('');
      updateCartBadge();
    }

    function addToCart(code){
      const p = PRODUCTS.find(x=>x.code===code); if(!p) return;
      const curStock = getStock(p);
      if(curStock <= 0){ alert('Stok yok'); return; }
      const it = cart.find(x=>x.code===code);
      if(it){ if(it.qty < curStock) it.qty++; else return alert('Stok yetersiz'); }
      else cart.push({code, qty:1});
      saveAll(); updateCartBadge(); openCheckout(1); renderCart();
    }

    function updateCartBadge(){
      const c = cart.reduce((s,i)=>s+i.qty,0); $('#cartCount').textContent = c; }

    // === SEPET & CHECKOUT ===
    $('#cartBtn').onclick = ()=>{ openCheckout(1); renderCart(); };
    $('#closeCheckout').onclick = ()=> closeCheckout();

    function openCheckout(step){ $('#checkoutView').classList.remove('hidden'); goStep(step||1); }
    function closeCheckout(){ $('#checkoutView').classList.add('hidden'); }

    function goStep(n){
      ['s1','s2','s3'].forEach((id,i)=>{ $('#'+id).classList.toggle('active', i===n-1); });
      $('#step1').classList.toggle('hidden', n!==1);
      $('#step2').classList.toggle('hidden', n!==2);
      $('#step3').classList.toggle('hidden', n!==3);
    }

    function renderCart(){
      const box = $('#cartItems');
      if(cart.length===0){ box.innerHTML = '<p class="text-slate-500">Sepet boÅŸ.</p>'; $('#cartSubtotal').textContent=fmt(0); return; }
      box.innerHTML = cart.map(ci=>{
        const p = PRODUCTS.find(x=>x.code===ci.code);
        return `<div class='flex items-center gap-3 border rounded-xl p-3'>
          <img src='${p.img||"https://images.unsplash.com/photo-1613339027986-b94d85708949?w=800&auto=format&fit=crop"}' class='w-16 h-16 object-cover rounded border'>
          <div class='flex-1'>
            <div class='font-semibold'>${p.title}</div>
            <div class='text-xs text-slate-500'>${p.code}</div>
            <div class='text-sm mt-1'>${fmt(p.discount)} Ã— ${ci.qty}</div>
          </div>
          <div class='flex items-center gap-1'>
            <button class='px-2 py-1 border rounded' onclick="decQty('${ci.code}')">-</button>
            <span class='w-6 text-center'>${ci.qty}</span>
            <button class='px-2 py-1 border rounded' onclick="incQty('${ci.code}')">+</button>
          </div>
          <button class='ml-2 text-slate-500 hover:text-red-600' onclick="removeItem('${ci.code}')">ğŸ—‘ï¸</button>
        </div>`;
      }).join('');
      const subtotal = cart.reduce((s,ci)=>{ const p=PRODUCTS.find(x=>x.code===ci.code); return s + (Number(p.discount)||0)*ci.qty; },0);
      $('#cartSubtotal').textContent = fmt(subtotal);
    }

    window.incQty = (code)=>{ const it=cart.find(x=>x.code===code); if(!it) return; const p=PRODUCTS.find(x=>x.code===code); const cur=getStock(p); if(it.qty < cur) it.qty++; saveAll(); renderCart(); updateCartBadge(); }
    window.decQty = (code)=>{ const it=cart.find(x=>x.code===code); if(!it) return; it.qty = Math.max(1, it.qty-1); saveAll(); renderCart(); updateCartBadge(); }
    window.removeItem = (code)=>{ cart = cart.filter(x=>x.code!==code); saveAll(); renderCart(); updateCartBadge(); }

    // Step nav
    $('#toStep2').onclick = ()=>{ if(cart.length===0){ alert('Sepet boÅŸ.'); return; } goStep(2); };
    $('#backTo1').onclick = ()=> goStep(1);
    $('#toStep3').onclick = ()=>{
      // bilgileri kaydet
      const fd = new FormData($('#infoForm'));
      customer = { name: fd.get('name')||'', phone: fd.get('phone')||'', address: fd.get('address')||'' };
      if(!customer.name){ alert('Ad Soyad gerekli'); return; }
      goStep(3);
    };
    $('#backTo2').onclick = ()=> goStep(2);

    // Final: EFT veya WhatsApp
    $('#payEFT').onclick = ()=> finalizeOrder('eft');
    $('#payWA').onclick  = ()=> finalizeOrder('wa');

    function finalizeOrder(mode){
      if(cart.length===0) { alert('Sepet boÅŸ.'); return; }
      // stok kontrol
      for(const ci of cart){ const p=PRODUCTS.find(x=>x.code===ci.code); const cur=getStock(p); if(cur < ci.qty){ alert(`${ci.code} iÃ§in stok yetersiz`); return; } }
      // stok dÃ¼ÅŸ ve purchased iÅŸaretle
      const items = cart.map(ci=>{ const p=PRODUCTS.find(x=>x.code===ci.code); const cur=getStock(p); setStock(p.code, cur - ci.qty); if(!purchased.includes(ci.code)) purchased.push(ci.code); return {title:p.title, code:p.code, qty:ci.qty, price:Number(p.discount)||0}; });
      const total = items.reduce((s,i)=> s + i.price*i.qty, 0);
      const orderCode = 'BY' + Date.now();
      lastOrder = { code: orderCode, items, total, customer };
      cart = []; saveAll(); renderProducts(); renderCart(); updateCartBadge();

      if(mode==='eft'){
        // IBAN sayfasÄ±na gÃ¶tÃ¼r
        openPaymentPage();
      } else {
        // WhatsApp baÄŸlantÄ±sÄ±
        const msg = encodeURIComponent(`Merhaba, sipariÅŸ vermek istiyorum.%0AAd Soyad: ${customer.name}%0ATelefon: ${customer.phone||'-'}%0AAdres: ${(customer.address||'-').replace(/\n/g,' ')}%0ASipariÅŸ Kodu: ${orderCode}%0A%0AÃœrÃ¼nler:%0A${items.map(i=>`- ${i.title} (${i.code}) x${i.qty} = ${i.price*i.qty} TL`).join('\n')}%0AToplam: ${total} TL`);
        const url = `https://wa.me/${waNum}?text=${msg}`;
        window.open(url,'_blank');
        alert('SipariÅŸin WhatsApp\'a aktarÄ±ldÄ±!');
        closeCheckout();
      }
    }

    function openPaymentPage(){
      // IBAN sayfasÄ± doldur
      $('#ibanName').textContent = SELLER_IBAN_NAME;
      $('#ibanText').textContent = SELLER_IBAN;
      $('#bankName').textContent = SELLER_BANK;
      $('#orderCodeSpan').textContent = lastOrder.code;
      $('#orderSummary').innerHTML = lastOrder.items.map(i=>`<div>${i.title} (${i.code}) Ã— ${i.qty} = ${fmt(i.price*i.qty)}</div>`).join('');
      $('#orderTotal').textContent = fmt(lastOrder.total);

      $('#paymentPage').classList.remove('hidden');
      $('#checkoutView').classList.add('hidden');
      location.hash = '#odeme';
    }

    $('#closePayment').onclick = ()=>{ $('#paymentPage').classList.add('hidden'); location.hash=''; };
    $('#copyIban').onclick = ()=>{ navigator.clipboard.writeText(SELLER_IBAN); alert('IBAN kopyalandÄ±'); };

    // === YORUMLAR ===
    function openReviews(code){
      const list = reviews[code] || [];
      let content = list.map(r=>`- ${r.text}${r.reply?"\n  â†³ Admin: "+r.reply:""}`).join('\n');
      if(!content) content = 'HenÃ¼z yorum yok.';
      // Sadece sipariÅŸ verilen Ã¼rÃ¼nlere yorum izni
      if(purchased.includes(code)){
        const newText = prompt('Yorumunu yaz (boÅŸ bÄ±rakÄ±rsan yorum eklenmez):');
        if(newText){ if(!reviews[code]) reviews[code]=[]; reviews[code].push({text:newText}); saveAll(); alert('Yorum kaydedildi!'); }
      }
      alert('Yorumlar:\n' + content + (purchased.includes(code)?'\n\n(SatÄ±n aldÄ±ÄŸÄ±n iÃ§in yorum ekleyebilirsin)':'\n\n(Yorum eklemek iÃ§in Ã¶nce satÄ±n almalÄ±sÄ±n)'));
    }

    // Ä°lk render
    renderProducts();
  </script>
</body>
</html>

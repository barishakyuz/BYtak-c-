<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BYtakı | E‑Ticaret (Kodla Yönetim)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card{box-shadow:0 8px 30px rgba(0,0,0,0.06)}
    .step.active{background:#6d28d9;color:#fff}
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <header class="bg-white border-b sticky top-0 z-50">
    <div class="max-w-7xl mx-auto p-4 flex items-center gap-3">
      <h1 class="text-2xl font-extrabold">BY<span class="text-fuchsia-600">takı</span></h1>
      <div class="ml-auto flex items-center gap-2">
        <button id="cartBtn" class="relative px-3 py-2 rounded-xl border">🛍️ Sepet <span id="cartCount" class="absolute -top-2 -right-2 text-xs bg-fuchsia-600 text-white rounded-full px-1">0</span></button>
      </div>
    </div>
    <!-- Global nav buttons -->
    <div class="bg-slate-100 border-t py-2">
      <div class="max-w-7xl mx-auto flex flex-wrap gap-3 justify-center">
        <a href="#" id="goHomeGlobal" class="px-4 py-2 rounded-xl border font-bold italic">Ana sayfaya git</a>
        <button id="continueShoppingGlobal" class="px-4 py-2 rounded-xl bg-fuchsia-600 text-white font-bold italic">Alışverişe devam et</button>
        <a id="contactSellerGlobal" target="_blank" class="px-4 py-2 rounded-xl border font-bold italic">Satıcıyla iletişime geç</a>
        <button id="openImgImport" class="px-4 py-2 rounded-xl border font-bold italic">Görselleri Ekle</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-6">
    <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    <div class="mt-6 flex gap-2">
      <a href="#" id="goHome" class="px-4 py-2 rounded-xl border">Ana sayfaya git</a>
      <button id="continueShopping" class="px-4 py-2 rounded-xl bg-fuchsia-600 text-white">Alışverişe devam et</button>
      <a id="contactSellerMain" target="_blank" class="px-4 py-2 rounded-xl border">Satıcıyla iletişime geç</a>
    </div>
  </main>

  <!-- Sepet & Checkout (tam ekran) -->
  <div id="checkoutView" class="fixed inset-0 bg-white hidden z-40 overflow-y-auto">
    <div class="max-w-4xl mx-auto p-6">
      <div class="flex items-center gap-2 mb-6">
        <h3 class="text-2xl font-bold">Satın Alma</h3>
        <button id="closeCheckout" class="ml-auto px-3 py-2 border rounded">Kapat</button>
      </div>
      <!-- Steps -->
      <div class="grid grid-cols-3 gap-2 mb-6">
        <div id="s1" class="step text-center py-2 rounded-xl border">1) Sepet</div>
        <div id="s2" class="step text-center py-2 rounded-xl border">2) Bilgiler</div>
        <div id="s3" class="step text-center py-2 rounded-xl border">3) Ödeme</div>
      </div>

      <!-- Step 1: Sepet -->
      <section id="step1" class="space-y-3">
        <div id="cartItems" class="space-y-3"></div>
        <div class="flex items-center justify-between border-t pt-4">
          <div class="text-lg">Ara Toplam: <strong id="cartSubtotal">₺0</strong></div>
          <button id="toStep2" class="px-4 py-2 rounded-xl bg-fuchsia-600 text-white">Devam Et</button>
        </div>
      </section>

      <!-- Step 2: Bilgiler -->
      <section id="step2" class="hidden">
        <form id="infoForm" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <input name="name" placeholder="Ad Soyad" class="border p-2 rounded" required>
          <input name="phone" placeholder="Telefon" class="border p-2 rounded">
          <textarea name="address" placeholder="Adres (isteğe bağlı)" rows="3" class="border p-2 rounded sm:col-span-2"></textarea>
        </form>
        <div class="flex items-center justify-between mt-4">
          <button id="backTo1" class="px-4 py-2 rounded-xl border">Geri</button>
          <button id="toStep3" class="px-4 py-2 rounded-xl bg-fuchsia-600 text-white">Ödeme Adımı</button>
        </div>
      </section>

      <!-- Step 3: Ödeme Seçenekleri -->
      <section id="step3" class="hidden">
        <div class="card border rounded-2xl p-4 mb-4">
          <h4 class="font-semibold mb-2">EFT / Havale</h4>
          <p class="text-sm text-slate-600">EFT ile ödemeyi seçtiğinde IBAN bilgilerinin olduğu sayfaya yönlendirileceksin.</p>
          <button id="payEFT" class="mt-3 px-4 py-2 rounded-xl bg-emerald-600 text-white">EFT ile Öde (IBAN sayfası)</button>
        </div>
        <div class="card border rounded-2xl p-4 mb-4">
          <h4 class="font-semibold mb-2">WhatsApp'tan İletişime Geç</h4>
          <p class="text-sm text-slate-600">Sipariş detayların hazır metinle WhatsApp'a aktarılır.</p>
          <button id="payWA" class="mt-3 px-4 py-2 rounded-xl border">WhatsApp'tan İletişime Geç</button>
        </div>
        <div class="flex flex-wrap gap-2 mt-2">
          <button id="backTo2" class="px-4 py-2 rounded-xl border">Geri</button>
          <button id="continueShopping2" class="px-4 py-2 rounded-xl bg-fuchsia-600 text-white">Alışverişe devam et</button>
          <a id="goHome2" href="#" class="px-4 py-2 rounded-xl border">Ana sayfaya git</a>
          <a id="contactSellerStep3" target="_blank" class="px-4 py-2 rounded-xl border">Satıcıyla iletişime geç</a>
        </div>
      </section>
    </div>
  </div>

  <!-- Ürün Detay Modal -->
  <div id="detailModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl w-full max-w-3xl card overflow-hidden">
      <div class="flex items-center gap-2 p-4 border-b">
        <h3 id="detailTitle" class="text-lg font-bold">Ürün Detayı</h3>
        <button id="detailClose" class="ml-auto text-slate-500 hover:text-slate-900">✖</button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
        <img id="detailImg" src="" alt="" class="w-full h-72 object-cover rounded-xl border">
        <div>
          <p class="text-xs text-slate-500">Kod: <span id="detailCode"></span></p>
          <div class="mt-2 flex items-end gap-2">
            <span id="detailDisc" class="text-2xl font-extrabold text-fuchsia-700"></span>
            <span id="detailPrice" class="text-sm line-through text-slate-400"></span>
          </div>
          <p id="detailDesc" class="mt-3 text-sm leading-6"></p>
          <div class="mt-6">
            <h4 class="font-semibold mb-2">Ürün Bilgisi</h4>
            <div id="detailInfo" class="space-y-3 text-sm">
              <p id="detailDesc"></p>
              <div>
                <h5 class="font-semibold">Yorumlar & Sorular</h5>
                <div id="detailReviews" class="space-y-2 text-xs text-slate-700"></div>
                <button id="detailAddReview" class="mt-2 px-3 py-1 rounded border">Yorum / Soru Yaz</button>
              </div>
            </div>
            <div class="mt-4 grid grid-cols-2 gap-2">
              <button id="detailAddCart" class="px-3 py-2 rounded-xl border">Sepete Ekle</button>
              <a id="detailContact" target="_blank" class="px-3 py-2 rounded-xl border text-center">Satıcıyla iletişime geç</a>
              <button id="detailContinue" class="px-3 py-2 rounded-xl bg-fuchsia-600 text-white">Alışverişe devam et</button>
              <a id="detailHome" href="#" class="px-3 py-2 rounded-xl border text-center">Ana sayfaya git</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Görsel Toplu Ekle Modal -->
  <div id="imgModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl w-full max-w-3xl card overflow-hidden">
      <div class="flex items-center gap-2 p-4 border-b">
        <h3 class="text-lg font-bold">Görsel URL Toplu Ekle</h3>
        <button id="imgClose" class="ml-auto text-slate-500 hover:text-slate-900">✖</button>
      </div>
      <div class="p-4 space-y-3">
        <p class="text-sm text-slate-600">Her satıra <strong>kod, görselURL</strong> yaz (virgül ile). Örn: <code>BY001, https://.../yuzuk.jpg</code></p>
        <textarea id="imgText" rows="10" class="w-full border rounded p-2 font-mono" placeholder="code, https://..."></textarea>
        <div class="flex gap-2">
          <button id="imgApply" class="px-4 py-2 rounded-xl bg-emerald-600 text-white">Kaydet</button>
          <button id="imgClear" class="px-4 py-2 rounded-xl border">Hepsini Sil</button>
        </div>
      </div>
    </div>
  </div>

  <!-- EFT Ödeme (IBAN) Sayfası -->
  <div id="paymentPage" class="fixed inset-0 bg-white hidden z-40 overflow-y-auto">
    <div class="max-w-3xl mx-auto p-6">
      <div class="flex items-center gap-2 mb-4">
        <h3 class="text-2xl font-bold">EFT / Havale Bilgileri</h3>
        <button id="closePayment" class="ml-auto px-3 py-2 border rounded">Kapat</button>
      </div>
      <div class="card border rounded-2xl p-4">
        <p><strong>Hesap Adı:</strong> <span id="ibanName"></span></p>
        <p class="mt-1"><strong>IBAN:</strong> <span id="ibanText" class="font-mono"></span> <button id="copyIban" class="ml-2 px-2 py-1 text-xs border rounded">Kopyala</button></p>
        <p class="mt-1"><strong>Banka:</strong> <span id="bankName"></span></p>
        <p class="mt-3 text-sm text-slate-600">Açıklama kısmına lütfen <strong id="orderCodeSpan"></strong> yazınız.</p>
      </div>
      <div class="mt-6">
        <h4 class="font-semibold mb-2">Sipariş Özeti</h4>
        <div id="orderSummary" class="space-y-2"></div>
        <div class="mt-2 text-lg">Toplam: <strong id="orderTotal"></strong></div>
      </div>
    </div>
  </div>

  <footer class="mt-10 border-t">
    <div class="max-w-7xl mx-auto p-4 text-sm">
      WhatsApp: <a id="waFooter" class="underline" target="_blank"></a>
      · Öneri/Şikayet: <a class="underline" href="mailto:barisha@yaani.com?subject=BYtaki%20Geri%20Bildirim">barisha@yaani.com</a>
    </div>
  </footer>

  <script>
    // === AYARLAR ===
    const SELLER_WHATSAPP = '+905303042950'; // wa.me için uluslararası format
    const SELLER_IBAN = 'TR00 0000 0000 0000 0000 0000 00'; // IBANINIZI girin
    const SELLER_IBAN_NAME = 'BYtakı'; // hesap adı
    const SELLER_BANK = 'Banka Adı'; // banka adı

    // === KODLA YÖNETİM (BURAYI DÜZENLE) ===
    // Ürünleri ekle/çıkar: Aşağıdaki PRODUCTS dizisini düzenle. Alanlar: title, code, price, discount, stock, img
    // IKAS'tan dönüştürdüğüm JSON/CSV'yi buraya yapıştırabilirsin.
    const PRODUCTS = [
  { title:'Cadena Göz Ataç Zincir Kombin Altın Renk Çelik Bileklik', code:'1649133321.0', price:220, discount:150, stock:1, img:'', desc:'Altın renk çelik bileklik.' },
  { title:'İç İçe Geçmeli Arnavut Asansör Unisex Gümüş Renk Çelik Bileklik', code:'1649132804.0', price:125, discount:75, stock:2, img:'', desc:'Unisex çelik bileklik.' },
  { title:'Yılan Kolye Bileklik Seti', code:'164913249.0', price:200, discount:150, stock:5, img:'', desc:'Set halinde kolye ve bileklik.' },
  // ... JSON’daki diğer tüm ürünler buraya
];

    ];

    // === STORAGE KEYS ===
    const LS_REVIEWS='bytaki_reviews';
    const LS_PURCHASED='bytaki_purchased';
    const LS_CART='bytaki_cart';
    const LS_STOCK_OVR='bytaki_stock_overrides';
    const LS_IMG_MAP='bytaki_img_map'; // kodla yönetimi bozmaz; sadece stok güncellemesi kalıcı olur

    // === STATE ===
    let reviews  = JSON.parse(localStorage.getItem(LS_REVIEWS) || '{}');
    let purchased= JSON.parse(localStorage.getItem(LS_PURCHASED) || '[]'); // tamamlanan siparişlerdeki ürün kodları
    let cart     = JSON.parse(localStorage.getItem(LS_CART) || '[]'); // [{code, qty}]
    let stockOv  = JSON.parse(localStorage.getItem(LS_STOCK_OVR) || '{}');
    let IMG_MAP  = JSON.parse(localStorage.getItem(LS_IMG_MAP) || '{}'); // {code: imgUrl} // {code: stok}
    let customer = {name:'', phone:'', address:''};
    let lastOrder = null; // {code, items:[{title,code,qty,price}], total}

    const $ = s => document.querySelector(s);
    const fmt = n => '₺' + Number(n||0).toLocaleString('tr-TR');

    // WhatsApp linklerini bağla
    const waNum = SELLER_WHATSAPP.replace(/\D/g,'');
    if(waNum){
      const waUrl = `https://wa.me/${waNum}`;
      const wh = document.getElementById('waHeader');
      const wf = document.getElementById('waFooter');
      if(wh){ wh.href = waUrl; wh.textContent = SELLER_WHATSAPP; wh.classList.remove('hidden'); }
      if(wf){ wf.href = waUrl; wf.textContent = SELLER_WHATSAPP; }
    }

    function saveAll(){
      localStorage.setItem(LS_REVIEWS, JSON.stringify(reviews));
      localStorage.setItem(LS_PURCHASED, JSON.stringify(purchased));
      localStorage.setItem(LS_CART, JSON.stringify(cart));
      localStorage.setItem(LS_STOCK_OVR, JSON.stringify(stockOv));
    }

    // Stok okuma / yazma (kodla yönetimi bozmadan kalıcı düşüş)
    function getStock(p){
      const ov = stockOv[p.code];
      return (ov===0 || ov) ? ov : (Number(p.stock)||0);
    }
    function setStock(code, value){ stockOv[code] = Math.max(0, Number(value)||0); saveAll(); }

    // === ÜRÜN LİSTE ===
    function renderProducts(){
      $('#productGrid').innerHTML = PRODUCTS.map(p=>{
        const curStock = getStock(p);
        const out = curStock <= 0;
        const imgUrl = (p.img && p.img.trim()) || IMG_MAP[p.code] || "https://images.unsplash.com/photo-1613339027986-b94d85708949?w=800&auto=format&fit=crop";
        return `
        <article class='card bg-white p-4 rounded-2xl border ${out?"opacity-60":""}'>
          <div class='cursor-pointer openDetail' data-code='${p.code}'>
            <img src='${imgUrl}' class='w-full h-48 object-cover rounded mb-3' alt='${p.title}'>
            <h3 class='font-bold'>${p.title}</h3>
          </div>
          <p class='text-xs text-slate-500'>Kod: ${p.code}</p>
          <p class='text-xs'>Stok: ${curStock}</p>
          <div class='mt-1'><span class='text-fuchsia-600 font-bold'>${fmt(p.discount)}</span> <span class='line-through text-sm text-slate-400'>${fmt(p.price)}</span></div>
          <div class='mt-3 flex gap-2'>
            <button onclick="addToCart('${p.code}')" class='px-3 py-2 rounded-xl border' ${out?'disabled':''}>Sepete Ekle</button>
            <button onclick="openDetail('${p.code}')" class='px-3 py-2 rounded-xl border'>Detay</button>
          </div>
        </article>`;
      }).join('');
      updateCartBadge();
      document.querySelectorAll('.openDetail').forEach(el=> el.addEventListener('click', ()=> openDetail(el.dataset.code)));
    }

    function addToCart(code){
      const p = PRODUCTS.find(x=>x.code===code); if(!p) return;
      const curStock = getStock(p);
      if(curStock <= 0){ alert('Stok yok'); return; }
      const it = cart.find(x=>x.code===code);
      if(it){ if(it.qty < curStock) it.qty++; else return alert('Stok yetersiz'); }
      else cart.push({code, qty:1});
      saveAll(); updateCartBadge(); openCheckout(1); renderCart();
    }

    function updateCartBadge(){
      const c = cart.reduce((s,i)=>s+i.qty,0); $('#cartCount').textContent = c; }

    // === SEPET & CHECKOUT ===
    $('#cartBtn').onclick = ()=>{ openCheckout(1); renderCart(); };
    $('#closeCheckout').onclick = ()=> closeCheckout();

    function openCheckout(step){ $('#checkoutView').classList.remove('hidden'); goStep(step||1); }
    function closeCheckout(){ $('#checkoutView').classList.add('hidden'); }

    function goStep(n){
      ['s1','s2','s3'].forEach((id,i)=>{ $('#'+id).classList.toggle('active', i===n-1); });
      $('#step1').classList.toggle('hidden', n!==1);
      $('#step2').classList.toggle('hidden', n!==2);
      $('#step3').classList.toggle('hidden', n!==3);
    }

    function renderCart(){
      const box = $('#cartItems');
      if(cart.length===0){ box.innerHTML = '<p class="text-slate-500">Sepet boş.</p>'; $('#cartSubtotal').textContent=fmt(0); return; }
      box.innerHTML = cart.map(ci=>{
        const p = PRODUCTS.find(x=>x.code===ci.code);
        return `<div class='flex items-center gap-3 border rounded-xl p-3'>
          <img src='${p.img||"https://images.unsplash.com/photo-1613339027986-b94d85708949?w=800&auto=format&fit=crop"}' class='w-16 h-16 object-cover rounded border'>
          <div class='flex-1'>
            <div class='font-semibold'>${p.title}</div>
            <div class='text-xs text-slate-500'>${p.code}</div>
            <div class='text-sm mt-1'>${fmt(p.discount)} × ${ci.qty}</div>
          </div>
          <div class='flex items-center gap-1'>
            <button class='px-2 py-1 border rounded' onclick="decQty('${ci.code}')">-</button>
            <span class='w-6 text-center'>${ci.qty}</span>
            <button class='px-2 py-1 border rounded' onclick="incQty('${ci.code}')">+</button>
          </div>
          <button class='ml-2 text-slate-500 hover:text-red-600' onclick="removeItem('${ci.code}')">🗑️</button>
        </div>`;
      }).join('');
      const subtotal = cart.reduce((s,ci)=>{ const p=PRODUCTS.find(x=>x.code===ci.code); return s + (Number(p.discount)||0)*ci.qty; },0);
      $('#cartSubtotal').textContent = fmt(subtotal);
    }

    window.incQty = (code)=>{ const it=cart.find(x=>x.code===code); if(!it) return; const p=PRODUCTS.find(x=>x.code===code); const cur=getStock(p); if(it.qty < cur) it.qty++; saveAll(); renderCart(); updateCartBadge(); }
    window.decQty = (code)=>{ const it=cart.find(x=>x.code===code); if(!it) return; it.qty = Math.max(1, it.qty-1); saveAll(); renderCart(); updateCartBadge(); }
    window.removeItem = (code)=>{ cart = cart.filter(x=>x.code!==code); saveAll(); renderCart(); updateCartBadge(); }

    // Step nav
    $('#toStep2').onclick = ()=>{ if(cart.length===0){ alert('Sepet boş.'); return; } goStep(2); };
    $('#backTo1').onclick = ()=> goStep(1);
    $('#toStep3').onclick = ()=>{
      // bilgileri kaydet
      const fd = new FormData($('#infoForm'));
      customer = { name: fd.get('name')||'', phone: fd.get('phone')||'', address: fd.get('address')||'' };
      if(!customer.name){ alert('Ad Soyad gerekli'); return; }
      goStep(3);
    };
    $('#backTo2').onclick = ()=> goStep(2);

    // Final: EFT veya WhatsApp
    $('#payEFT').onclick = ()=> finalizeOrder('eft');
    $('#payWA').onclick  = ()=> finalizeOrder('wa');

    function finalizeOrder(mode){
      if(cart.length===0) { alert('Sepet boş.'); return; }
      for(const ci of cart){ const p=PRODUCTS.find(x=>x.code===ci.code); const cur=getStock(p); if(cur < ci.qty){ alert(`${ci.code} için stok yetersiz`); return; } }
      const items = cart.map(ci=>{ const p=PRODUCTS.find(x=>x.code===ci.code); const cur=getStock(p); setStock(p.code, cur - ci.qty); if(!purchased.includes(ci.code)) purchased.push(ci.code); return {title:p.title, code:p.code, qty:ci.qty, price:Number(p.discount)||0}; });
      const total = items.reduce((s,i)=> s + i.price*i.qty, 0);
      const orderCode = 'BY' + Date.now();
      lastOrder = { code: orderCode, items, total, customer };
      cart = []; saveAll(); renderProducts(); renderCart(); updateCartBadge();

      if(mode==='eft'){
        openPaymentPage();
      } else {
        const msg = encodeURIComponent(`Merhaba, sipariş vermek istiyorum.%0AAd Soyad: ${customer.name}%0ATelefon: ${customer.phone||'-'}%0AAdres: ${(customer.address||'-').replace(/
/g,' ')}%0ASipariş Kodu: ${orderCode}%0A%0AÜrünler:%0A${items.map(i=>`- ${i.title} (${i.code}) x${i.qty} = ${i.price*i.qty} TL`).join('
')}%0AToplam: ${total} TL`);
        const url = `https://wa.me/${waNum}?text=${msg}`;
        window.open(url,'_blank');
        alert('Siparişin WhatsApp\'a aktarıldı!');
        closeCheckout();
      }
    }

    function openPaymentPage(){
      // IBAN sayfası doldur
      $('#ibanName').textContent = SELLER_IBAN_NAME;
      $('#ibanText').textContent = SELLER_IBAN;
      $('#bankName').textContent = SELLER_BANK;
      $('#orderCodeSpan').textContent = lastOrder.code;
      $('#orderSummary').innerHTML = lastOrder.items.map(i=>`<div>${i.title} (${i.code}) × ${i.qty} = ${fmt(i.price*i.qty)}</div>`).join('');
      $('#orderTotal').textContent = fmt(lastOrder.total);

      $('#paymentPage').classList.remove('hidden');
      $('#checkoutView').classList.add('hidden');
      location.hash = '#odeme';
    }

    $('#closePayment').onclick = ()=>{ $('#paymentPage').classList.add('hidden'); location.hash=''; };
    $('#copyIban').onclick = ()=>{ navigator.clipboard.writeText(SELLER_IBAN); alert('IBAN kopyalandı'); };

    // === YORUMLAR ===
    function openReviews(code){
      const list = reviews[code] || [];
      let content = list.map(r=>`- ${r.text}${r.reply?"
  ↳ Admin: "+r.reply:""}`).join('
');
      if(!content) content = 'Henüz yorum yok.';
      if(purchased.includes(code)){
        const newText = prompt('Yorumunu yaz (boş bırakırsan yorum eklenmez):');
        if(newText){ if(!reviews[code]) reviews[code]=[]; reviews[code].push({text:newText}); saveAll(); alert('Yorum kaydedildi!'); }
      }
      alert('Yorumlar:
' + content + (purchased.includes(code)?'

(Satın aldığın için yorum ekleyebilirsin)':'

(Yorum eklemek için önce satın almalısın)'));
    }

    // === ÜRÜN DETAY ===
    function openDetail(code){
      const p = PRODUCTS.find(x=>x.code===code); if(!p) return;
      document.getElementById('detailTitle').textContent = p.title;
      const dImg = (p.img && p.img.trim()) || IMG_MAP[p.code] || 'https://images.unsplash.com/photo-1613339027986-b94d85708949?w=800&auto=format&fit=crop';
      document.getElementById('detailImg').src = dImg;
      document.getElementById('detailImg').alt = p.title;
      document.getElementById('detailCode').textContent = p.code;
      document.getElementById('detailDisc').textContent = fmt(p.discount);
      document.getElementById('detailPrice').textContent = fmt(p.price);
      document.getElementById('detailDesc').textContent = p.desc || 'Bu ürün için açıklama henüz eklenmedi.';
      document.getElementById('detailAddCart').onclick = ()=>{ addToCart(code); };
      document.getElementById('detailContact').href = `https://wa.me/${waNum}?text=${encodeURIComponent('Merhaba, '+p.title+' ('+p.code+') hakkında bilgi almak istiyorum.')}`;
      document.getElementById('detailContinue').onclick = ()=>{ closeDetail(); };
      document.getElementById('detailHome').onclick = (e)=>{ e.preventDefault(); closeDetail(); window.scrollTo({top:0,behavior:'smooth'}); };
      const dm = document.getElementById('detailModal'); dm.classList.remove('hidden'); dm.classList.add('flex');
    }
    function closeDetail(){ const dm = document.getElementById('detailModal'); dm.classList.add('hidden'); dm.classList.remove('flex'); }
    document.getElementById('detailClose').onclick = closeDetail;
    document.getElementById('detailModal').addEventListener('click', (e)=>{ if(e.target.id==='detailModal') closeDetail(); });

    // === NAVİGASYON BUTONLARI ===
    document.getElementById('continueShopping').onclick = ()=> window.scrollTo({top:0,behavior:'smooth'});
    document.getElementById('continueShopping2').onclick = ()=>{ closeCheckout(); window.scrollTo({top:0,behavior:'smooth'}); };
    document.getElementById('goHome').onclick = (e)=>{ e.preventDefault(); window.scrollTo({top:0,behavior:'smooth'}); };
    document.getElementById('goHome2').onclick = (e)=>{ e.preventDefault(); closeCheckout(); window.scrollTo({top:0,behavior:'smooth'}); };
    document.getElementById('contactSellerMain').href = `https://wa.me/${waNum}`;
    document.getElementById('contactSellerStep3').href = `https://wa.me/${waNum}`;

    // Görsel modal kontrol
    document.getElementById('openImgImport').onclick = ()=>{ const m=document.getElementById('imgModal'); m.classList.remove('hidden'); m.classList.add('flex'); };
    document.getElementById('imgClose').onclick = ()=>{ const m=document.getElementById('imgModal'); m.classList.add('hidden'); m.classList.remove('flex'); };
    document.getElementById('imgApply').onclick = ()=>{
      const txt = document.getElementById('imgText').value.split('
');
      let count=0;
      txt.forEach(line=>{
        if(!line.trim()) return;
        const parts = line.split(',');
        const code = (parts[0]||'').trim();
        const url = (parts.slice(1).join(',')||'').trim();
        if(code && url){ IMG_MAP[code]=url; count++; }
      });
      localStorage.setItem(LS_IMG_MAP, JSON.stringify(IMG_MAP));
      renderProducts();
      alert(count + ' görsel kaydedildi');
    };
    document.getElementById('imgClear').onclick = ()=>{ if(!confirm('Tüm görsel eşleştirmeleri silinsin mi?')) return; IMG_MAP={}; localStorage.setItem(LS_IMG_MAP,'{}'); renderProducts(); };

    // İlk render
    renderProducts();
  </script>
</body>
</html>
